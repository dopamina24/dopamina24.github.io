<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElectroChile - Electrolineras en Chile</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h1 class="logo">&#9889; ElectroChile</h1>
            <button id="sidebar-close" class="sidebar-close" aria-label="Cerrar panel">&times;</button>
        </div>

        <!-- Tabs -->
        <div class="tab-bar">
            <button class="tab-btn active" data-tab="finder">Buscador</button>
            <button class="tab-btn" data-tab="planner">Planificador de Ruta</button>
        </div>

        <div class="sidebar-content">
            <!-- ====== TAB: FINDER ====== -->
            <div id="tab-finder" class="tab-panel active">
            <!-- Search with autocomplete -->
            <div class="search-section">
                <div class="search-box">
                    <div class="search-input-wrap">
                        <input type="text" id="search-input" placeholder="Buscar comuna, ciudad o direcci&oacute;n..." autocomplete="off">
                        <div id="autocomplete-list" class="ac-list hidden"></div>
                    </div>
                    <button id="search-btn" class="btn btn-search" aria-label="Buscar">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    </button>
                </div>
                <button id="locate-btn" class="btn btn-locate">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/></svg>
                    Usar mi ubicaci&oacute;n
                </button>
            </div>

            <!-- Filters -->
            <div class="filters-section">
                <h3 class="section-title">Filtros</h3>

                <div class="filter-group">
                    <label class="filter-label">Radio de b&uacute;squeda</label>
                    <div class="range-container">
                        <input type="range" id="radius-range" min="5" max="200" value="25" step="5">
                        <span id="radius-value">25 km</span>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Tipo de conector</label>
                    <div class="connector-filters" id="connector-filters">
                        <label class="checkbox-label"><input type="checkbox" value="all" checked> Todos</label>
                        <label class="checkbox-label"><input type="checkbox" value="CCS 2"> CCS 2</label>
                        <label class="checkbox-label"><input type="checkbox" value="Tipo 2"> Tipo 2 (Mennekes)</label>
                        <label class="checkbox-label"><input type="checkbox" value="CHAdeMO"> CHAdeMO</label>
                        <label class="checkbox-label"><input type="checkbox" value="Tipo 1"> Tipo 1 (J1772)</label>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Tipo de corriente</label>
                    <div class="power-type-filters" id="power-type-filters">
                        <label class="checkbox-label"><input type="checkbox" value="all" checked> Todos</label>
                        <label class="checkbox-label"><input type="checkbox" value="DC"> DC (Carga r&aacute;pida)</label>
                        <label class="checkbox-label"><input type="checkbox" value="AC"> AC (Carga lenta)</label>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Estado</label>
                    <select id="status-filter" class="select-filter">
                        <option value="all">Todas</option>
                        <option value="available">Disponibles</option>
                        <option value="inuse">En uso</option>
                        <option value="unavailable">No disponibles</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Operador</label>
                    <select id="owner-filter" class="select-filter">
                        <option value="all">Todos</option>
                    </select>
                </div>
            </div>

            <!-- Results -->
            <div class="results-section">
                <div class="results-header">
                    <h3 class="section-title">Estaciones</h3>
                    <span id="results-count" class="results-count">0 encontradas</span>
                </div>
                <div id="results-list" class="results-list">
                    <div class="empty-state">
                        <p>Cargando estaciones desde EcoCarga...</p>
                    </div>
                </div>
            </div>

            <!-- Data source -->
            <div class="data-source">
                <span id="data-info">Conectando...</span>
            </div>
            </div><!-- /tab-finder -->

            <!-- ====== TAB: ROUTE PLANNER ====== -->
            <div id="tab-planner" class="tab-panel">
                <div class="planner-section">
                    <h3 class="section-title">Planifica tu viaje</h3>

                    <div class="planner-form">
                        <div class="planner-group">
                            <label class="filter-label">Origen</label>
                            <div class="planner-input-wrap">
                                <input type="text" id="planner-origin" placeholder="Ciudad, comuna o direcci&oacute;n..." autocomplete="off">
                                <div id="planner-origin-ac" class="ac-list hidden"></div>
                            </div>
                            <button id="planner-use-location" class="btn btn-locate btn-sm">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/></svg>
                                Usar mi ubicaci&oacute;n
                            </button>
                        </div>

                        <div class="planner-group">
                            <label class="filter-label">Destino</label>
                            <div class="planner-input-wrap">
                                <input type="text" id="planner-dest" placeholder="Ciudad, comuna o direcci&oacute;n..." autocomplete="off">
                                <div id="planner-dest-ac" class="ac-list hidden"></div>
                            </div>
                        </div>

                        <div class="planner-row">
                            <div class="planner-group planner-half">
                                <label class="filter-label">Bater&iacute;a (kWh)</label>
                                <input type="number" id="planner-battery" class="planner-number" placeholder="Ej: 60" min="10" max="200" value="60">
                            </div>
                            <div class="planner-group planner-half">
                                <label class="filter-label">Terreno</label>
                                <select id="planner-terrain" class="select-filter">
                                    <option value="flat">Plano (ruta costera)</option>
                                    <option value="moderate" selected>Colinas moderadas</option>
                                    <option value="mountain">Monta&ntilde;a / cordillera</option>
                                </select>
                            </div>
                        </div>

                        <div class="planner-group">
                            <label class="filter-label">Autonomia estimada</label>
                            <div class="range-display" id="planner-range-display">
                                <span class="range-big" id="planner-range-km">~353 km</span>
                                <span class="range-detail" id="planner-range-detail">60 kWh &middot; Colinas &middot; ~17 kWh/100km</span>
                            </div>
                        </div>

                        <button id="planner-go" class="btn btn-primary-full">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M13 6l6 6-6 6"/></svg>
                            Planificar ruta
                        </button>
                    </div>
                </div>

                <!-- Route results -->
                <div id="planner-results" class="planner-results hidden">
                    <div class="planner-summary" id="planner-summary"></div>
                    <div class="planner-stops-header">
                        <h3 class="section-title">Paradas de carga sugeridas</h3>
                        <span id="planner-stops-count" class="results-count"></span>
                    </div>
                    <div id="planner-stops-list" class="results-list"></div>
                </div>
            </div><!-- /tab-planner -->
        </div>
    </aside>

    <!-- Mobile toggle -->
    <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Abrir panel">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>

    <!-- Map -->
    <div id="map"></div>

    <!-- Loading -->
    <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <p id="loading-text">Buscando electrolineras...</p>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="app.js"></script>
</body>
</html>
